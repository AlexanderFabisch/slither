<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>slither.service API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>slither.service</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">from . import domain_model
from .core.config import config
from .loader import Loader
from .io.tcx_export import TcxExport
from .database import Database
from .registry import Registry
from .summary import WeekSummary, MonthSummary, YearSummary
from .synchronization import Synchronizer
import sqlalchemy
from sqlalchemy import func
from datetime import timedelta
import os


class Service:
    def __init__(self, debug=False, db_filename=&#34;db.sqlite&#34;, datadir=&#34;data&#34;,
                 remote=None, username=None, password=None, base_path=None):
        self.debug = debug
        self.db_filename = db_filename
        self.datadir = datadir
        self.remote = remote
        self.username = username
        self.password = password
        self.base_path = base_path

        temp_dir = self._setup_directories(debug, datadir)
        self.database = Database(os.path.join(temp_dir, db_filename))
        self.registry = Registry(temp_dir)

    def _setup_directories(self, debug, datadir):
        if self.base_path is None:
            if debug:
                temp_dir = os.path.expanduser(
                    os.path.join(&#34;~&#34;, &#34;.slither&#34;, &#34;debug&#34;))
            else:
                temp_dir = os.path.expanduser(os.path.join(&#34;~&#34;, &#34;.slither&#34;))
        else:
            temp_dir = self.base_path
        config[&#34;temp_dir&#34;] = temp_dir
        self.full_datadir = os.path.join(temp_dir, datadir)
        if not os.path.exists(self.full_datadir):
            os.makedirs(self.full_datadir)
        if not os.path.exists(os.path.join(temp_dir, &#34;cache&#34;)):
            os.makedirs(os.path.join(temp_dir, &#34;cache&#34;))
        return temp_dir

    def clone(self):
        return Service(self.debug, self.db_filename, self.datadir,
                       self.remote, self.username, self.password,
                       self.base_path)

    def list_activities(self):
        q = self.database.session.query(domain_model.Activity)
        return q.order_by(sqlalchemy.desc(domain_model.Activity.start_time)
                          ).all()

    def list_activity_for_date(self, date):
        return self.database.list_activities_between(
            date, date + timedelta(days=1))

    def new_activity(self, metadata):
        &#34;&#34;&#34;Add new activity.

        Deprecated. Use add_new_activity instead.

        Parameters
        ----------
        metadata : dict
            Activity metadata.
        &#34;&#34;&#34;
        if &#34;sport&#34; not in metadata:
            raise ValueError(&#34;Sport is missing.&#34;)
        if &#34;start_time&#34; not in metadata:
            raise ValueError(&#34;Start time is missing.&#34;)

        activity = domain_model.Activity(**metadata)

        self._store_activity(activity)

    def update_activity(self, activity, metadata):
        self.registry.delete(activity.get_filename())
        self._delete_records_for(activity)
        self.database.session.flush()

        for k, v in metadata.items():
            setattr(activity, k, v)

        self._store_activity(activity)

    def _store_activity(self, activity):
        self.database.session.add(activity)
        self.database.session.flush()

        self._add_records_for(activity)
        self.database.session.commit()

        tcx = TcxExport().dumps(activity)
        target_filename = os.path.join(
            self.full_datadir, activity.get_filename())
        self.registry.update(tcx, target_filename)

    def _add_records_for(self, activity):
        distances = config[&#34;records&#34;].get(activity.sport, [])
        for distance in distances:
            record = activity.compute_records(distance)
            self.database.session.add(record)

    def import_activity(self, file_content, filename=None, timestamp=None):
        &#34;&#34;&#34;Import activity from a format that can be inferred automatically.

        Parameters
        ----------
        file_content : str
            Activity in a format like e.g. TCX

        filename : str, optional (default: None)
            Filename that can be used to infer the data format, e.g. &#34;test.tcx&#34;

        timestamp : float, optional (default: None)
            Timestamp of last update (in case this activity has been
            transferred from a remote data repository)
        &#34;&#34;&#34;
        loader = Loader(filename)
        loader = loader.get_loader(file_content)

        activity = loader.load()

        self.add_new_activity(activity, timestamp)

    def add_new_activity(self, activity, timestamp=None):
        &#34;&#34;&#34;Add new activity.

        Parameters
        ----------
        activity : Activity
            New activity.

        timestamp : float, optional (default: None)
            Timestamp of last update (in case this activity has been
            transferred from a remote data repository)
        &#34;&#34;&#34;
        target_filename = os.path.join(
            self.full_datadir, activity.get_filename())
        if os.path.exists(target_filename):
            raise ValueError(&#34;File &#39;%s&#39; exists already&#34; % target_filename)
        self.database.session.add(activity)
        self.database.session.flush()
        self._add_records_for(activity)
        self.database.session.commit()
        try:
            tcx = TcxExport().dumps(activity)
            self.registry.update(tcx, target_filename, timestamp)
        except:
            self.delete_activity(activity)
            raise IOError(&#34;File &#39;%s&#39; could not be written&#34; % target_filename)

    def _get_record_distances(self, sport):
        q = self.database.session.query(domain_model.Record.distance)
        res = q.filter(domain_model.Record.sport == sport).distinct(
            domain_model.Record.distance).all()
        return [distance for distance, in res]

    def delete_activity(self, activity):
        filename = os.path.join(self.full_datadir, activity.get_filename())
        self._delete_records_for(activity)
        self.database.session.delete(activity)
        self.database.session.commit()
        self.registry.delete(filename)

    def _delete_records_for(self, activity):
        for record in self._get_records_for_activity(activity):
            self.database.session.delete(record)

    def get_best_splits(self, activity):
        records = self._get_records_for_activity(activity)
        return [(record.distance, record.time) for record in records]

    def _get_records_for_activity(self, activity):
        q = self.database.session.query(domain_model.Record)
        records = q.filter(domain_model.Record.activity_id == activity.id
                           ).order_by(domain_model.Record.distance).all()
        return records

    def list_records(self):
        q = self.database.session.query(domain_model.Record, func.min(domain_model.Record.time))
        grouped = q.filter(domain_model.Record.valid).group_by(
            domain_model.Record.sport, domain_model.Record.distance)
        res = grouped.order_by(domain_model.Record.sport, domain_model.Record.distance).all()
        return [record for record, _ in res]

    def summarize_weeks(self, sport=None):
        return WeekSummary(self.database).summarize(sport)

    def summarize_months(self, sport=None):
        return MonthSummary(self.database).summarize(sport)

    def summarize_years(self, sport=None):
        return YearSummary(self.database).summarize(sport)

    def invalidate_record(self, record):
        record.valid = False
        self.database.session.commit()

    def sync_to_server(self):
        Synchronizer(self, self.remote, self.username, self.password
                     ).sync_to_server()</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="slither.service.Service"><code class="flex name class">
<span>class <span class="ident">Service</span></span>
<span>(</span><span>debug=False, db_filename='db.sqlite', datadir='data', remote=None, username=None, password=None, base_path=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Service:
    def __init__(self, debug=False, db_filename=&#34;db.sqlite&#34;, datadir=&#34;data&#34;,
                 remote=None, username=None, password=None, base_path=None):
        self.debug = debug
        self.db_filename = db_filename
        self.datadir = datadir
        self.remote = remote
        self.username = username
        self.password = password
        self.base_path = base_path

        temp_dir = self._setup_directories(debug, datadir)
        self.database = Database(os.path.join(temp_dir, db_filename))
        self.registry = Registry(temp_dir)

    def _setup_directories(self, debug, datadir):
        if self.base_path is None:
            if debug:
                temp_dir = os.path.expanduser(
                    os.path.join(&#34;~&#34;, &#34;.slither&#34;, &#34;debug&#34;))
            else:
                temp_dir = os.path.expanduser(os.path.join(&#34;~&#34;, &#34;.slither&#34;))
        else:
            temp_dir = self.base_path
        config[&#34;temp_dir&#34;] = temp_dir
        self.full_datadir = os.path.join(temp_dir, datadir)
        if not os.path.exists(self.full_datadir):
            os.makedirs(self.full_datadir)
        if not os.path.exists(os.path.join(temp_dir, &#34;cache&#34;)):
            os.makedirs(os.path.join(temp_dir, &#34;cache&#34;))
        return temp_dir

    def clone(self):
        return Service(self.debug, self.db_filename, self.datadir,
                       self.remote, self.username, self.password,
                       self.base_path)

    def list_activities(self):
        q = self.database.session.query(domain_model.Activity)
        return q.order_by(sqlalchemy.desc(domain_model.Activity.start_time)
                          ).all()

    def list_activity_for_date(self, date):
        return self.database.list_activities_between(
            date, date + timedelta(days=1))

    def new_activity(self, metadata):
        &#34;&#34;&#34;Add new activity.

        Deprecated. Use add_new_activity instead.

        Parameters
        ----------
        metadata : dict
            Activity metadata.
        &#34;&#34;&#34;
        if &#34;sport&#34; not in metadata:
            raise ValueError(&#34;Sport is missing.&#34;)
        if &#34;start_time&#34; not in metadata:
            raise ValueError(&#34;Start time is missing.&#34;)

        activity = domain_model.Activity(**metadata)

        self._store_activity(activity)

    def update_activity(self, activity, metadata):
        self.registry.delete(activity.get_filename())
        self._delete_records_for(activity)
        self.database.session.flush()

        for k, v in metadata.items():
            setattr(activity, k, v)

        self._store_activity(activity)

    def _store_activity(self, activity):
        self.database.session.add(activity)
        self.database.session.flush()

        self._add_records_for(activity)
        self.database.session.commit()

        tcx = TcxExport().dumps(activity)
        target_filename = os.path.join(
            self.full_datadir, activity.get_filename())
        self.registry.update(tcx, target_filename)

    def _add_records_for(self, activity):
        distances = config[&#34;records&#34;].get(activity.sport, [])
        for distance in distances:
            record = activity.compute_records(distance)
            self.database.session.add(record)

    def import_activity(self, file_content, filename=None, timestamp=None):
        &#34;&#34;&#34;Import activity from a format that can be inferred automatically.

        Parameters
        ----------
        file_content : str
            Activity in a format like e.g. TCX

        filename : str, optional (default: None)
            Filename that can be used to infer the data format, e.g. &#34;test.tcx&#34;

        timestamp : float, optional (default: None)
            Timestamp of last update (in case this activity has been
            transferred from a remote data repository)
        &#34;&#34;&#34;
        loader = Loader(filename)
        loader = loader.get_loader(file_content)

        activity = loader.load()

        self.add_new_activity(activity, timestamp)

    def add_new_activity(self, activity, timestamp=None):
        &#34;&#34;&#34;Add new activity.

        Parameters
        ----------
        activity : Activity
            New activity.

        timestamp : float, optional (default: None)
            Timestamp of last update (in case this activity has been
            transferred from a remote data repository)
        &#34;&#34;&#34;
        target_filename = os.path.join(
            self.full_datadir, activity.get_filename())
        if os.path.exists(target_filename):
            raise ValueError(&#34;File &#39;%s&#39; exists already&#34; % target_filename)
        self.database.session.add(activity)
        self.database.session.flush()
        self._add_records_for(activity)
        self.database.session.commit()
        try:
            tcx = TcxExport().dumps(activity)
            self.registry.update(tcx, target_filename, timestamp)
        except:
            self.delete_activity(activity)
            raise IOError(&#34;File &#39;%s&#39; could not be written&#34; % target_filename)

    def _get_record_distances(self, sport):
        q = self.database.session.query(domain_model.Record.distance)
        res = q.filter(domain_model.Record.sport == sport).distinct(
            domain_model.Record.distance).all()
        return [distance for distance, in res]

    def delete_activity(self, activity):
        filename = os.path.join(self.full_datadir, activity.get_filename())
        self._delete_records_for(activity)
        self.database.session.delete(activity)
        self.database.session.commit()
        self.registry.delete(filename)

    def _delete_records_for(self, activity):
        for record in self._get_records_for_activity(activity):
            self.database.session.delete(record)

    def get_best_splits(self, activity):
        records = self._get_records_for_activity(activity)
        return [(record.distance, record.time) for record in records]

    def _get_records_for_activity(self, activity):
        q = self.database.session.query(domain_model.Record)
        records = q.filter(domain_model.Record.activity_id == activity.id
                           ).order_by(domain_model.Record.distance).all()
        return records

    def list_records(self):
        q = self.database.session.query(domain_model.Record, func.min(domain_model.Record.time))
        grouped = q.filter(domain_model.Record.valid).group_by(
            domain_model.Record.sport, domain_model.Record.distance)
        res = grouped.order_by(domain_model.Record.sport, domain_model.Record.distance).all()
        return [record for record, _ in res]

    def summarize_weeks(self, sport=None):
        return WeekSummary(self.database).summarize(sport)

    def summarize_months(self, sport=None):
        return MonthSummary(self.database).summarize(sport)

    def summarize_years(self, sport=None):
        return YearSummary(self.database).summarize(sport)

    def invalidate_record(self, record):
        record.valid = False
        self.database.session.commit()

    def sync_to_server(self):
        Synchronizer(self, self.remote, self.username, self.password
                     ).sync_to_server()</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="slither.service.Service.add_new_activity"><code class="name flex">
<span>def <span class="ident">add_new_activity</span></span>(<span>self, activity, timestamp=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Add new activity.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>activity</code></strong> :&ensp;<code>Activity</code></dt>
<dd>New activity.</dd>
<dt><strong><code>timestamp</code></strong> :&ensp;<code>float</code>, optional <code>(default: None)</code></dt>
<dd>Timestamp of last update (in case this activity has been
transferred from a remote data repository)</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_new_activity(self, activity, timestamp=None):
    &#34;&#34;&#34;Add new activity.

    Parameters
    ----------
    activity : Activity
        New activity.

    timestamp : float, optional (default: None)
        Timestamp of last update (in case this activity has been
        transferred from a remote data repository)
    &#34;&#34;&#34;
    target_filename = os.path.join(
        self.full_datadir, activity.get_filename())
    if os.path.exists(target_filename):
        raise ValueError(&#34;File &#39;%s&#39; exists already&#34; % target_filename)
    self.database.session.add(activity)
    self.database.session.flush()
    self._add_records_for(activity)
    self.database.session.commit()
    try:
        tcx = TcxExport().dumps(activity)
        self.registry.update(tcx, target_filename, timestamp)
    except:
        self.delete_activity(activity)
        raise IOError(&#34;File &#39;%s&#39; could not be written&#34; % target_filename)</code></pre>
</details>
</dd>
<dt id="slither.service.Service.clone"><code class="name flex">
<span>def <span class="ident">clone</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def clone(self):
    return Service(self.debug, self.db_filename, self.datadir,
                   self.remote, self.username, self.password,
                   self.base_path)</code></pre>
</details>
</dd>
<dt id="slither.service.Service.delete_activity"><code class="name flex">
<span>def <span class="ident">delete_activity</span></span>(<span>self, activity)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def delete_activity(self, activity):
    filename = os.path.join(self.full_datadir, activity.get_filename())
    self._delete_records_for(activity)
    self.database.session.delete(activity)
    self.database.session.commit()
    self.registry.delete(filename)</code></pre>
</details>
</dd>
<dt id="slither.service.Service.get_best_splits"><code class="name flex">
<span>def <span class="ident">get_best_splits</span></span>(<span>self, activity)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_best_splits(self, activity):
    records = self._get_records_for_activity(activity)
    return [(record.distance, record.time) for record in records]</code></pre>
</details>
</dd>
<dt id="slither.service.Service.import_activity"><code class="name flex">
<span>def <span class="ident">import_activity</span></span>(<span>self, file_content, filename=None, timestamp=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Import activity from a format that can be inferred automatically.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>file_content</code></strong> :&ensp;<code>str</code></dt>
<dd>Activity in a format like e.g. TCX</dd>
<dt><strong><code>filename</code></strong> :&ensp;<code>str</code>, optional <code>(default: None)</code></dt>
<dd>Filename that can be used to infer the data format, e.g. "test.tcx"</dd>
<dt><strong><code>timestamp</code></strong> :&ensp;<code>float</code>, optional <code>(default: None)</code></dt>
<dd>Timestamp of last update (in case this activity has been
transferred from a remote data repository)</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def import_activity(self, file_content, filename=None, timestamp=None):
    &#34;&#34;&#34;Import activity from a format that can be inferred automatically.

    Parameters
    ----------
    file_content : str
        Activity in a format like e.g. TCX

    filename : str, optional (default: None)
        Filename that can be used to infer the data format, e.g. &#34;test.tcx&#34;

    timestamp : float, optional (default: None)
        Timestamp of last update (in case this activity has been
        transferred from a remote data repository)
    &#34;&#34;&#34;
    loader = Loader(filename)
    loader = loader.get_loader(file_content)

    activity = loader.load()

    self.add_new_activity(activity, timestamp)</code></pre>
</details>
</dd>
<dt id="slither.service.Service.invalidate_record"><code class="name flex">
<span>def <span class="ident">invalidate_record</span></span>(<span>self, record)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def invalidate_record(self, record):
    record.valid = False
    self.database.session.commit()</code></pre>
</details>
</dd>
<dt id="slither.service.Service.list_activities"><code class="name flex">
<span>def <span class="ident">list_activities</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def list_activities(self):
    q = self.database.session.query(domain_model.Activity)
    return q.order_by(sqlalchemy.desc(domain_model.Activity.start_time)
                      ).all()</code></pre>
</details>
</dd>
<dt id="slither.service.Service.list_activity_for_date"><code class="name flex">
<span>def <span class="ident">list_activity_for_date</span></span>(<span>self, date)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def list_activity_for_date(self, date):
    return self.database.list_activities_between(
        date, date + timedelta(days=1))</code></pre>
</details>
</dd>
<dt id="slither.service.Service.list_records"><code class="name flex">
<span>def <span class="ident">list_records</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def list_records(self):
    q = self.database.session.query(domain_model.Record, func.min(domain_model.Record.time))
    grouped = q.filter(domain_model.Record.valid).group_by(
        domain_model.Record.sport, domain_model.Record.distance)
    res = grouped.order_by(domain_model.Record.sport, domain_model.Record.distance).all()
    return [record for record, _ in res]</code></pre>
</details>
</dd>
<dt id="slither.service.Service.new_activity"><code class="name flex">
<span>def <span class="ident">new_activity</span></span>(<span>self, metadata)</span>
</code></dt>
<dd>
<div class="desc"><p>Add new activity.</p>
<p>Deprecated. Use add_new_activity instead.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>metadata</code></strong> :&ensp;<code>dict</code></dt>
<dd>Activity metadata.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def new_activity(self, metadata):
    &#34;&#34;&#34;Add new activity.

    Deprecated. Use add_new_activity instead.

    Parameters
    ----------
    metadata : dict
        Activity metadata.
    &#34;&#34;&#34;
    if &#34;sport&#34; not in metadata:
        raise ValueError(&#34;Sport is missing.&#34;)
    if &#34;start_time&#34; not in metadata:
        raise ValueError(&#34;Start time is missing.&#34;)

    activity = domain_model.Activity(**metadata)

    self._store_activity(activity)</code></pre>
</details>
</dd>
<dt id="slither.service.Service.summarize_months"><code class="name flex">
<span>def <span class="ident">summarize_months</span></span>(<span>self, sport=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def summarize_months(self, sport=None):
    return MonthSummary(self.database).summarize(sport)</code></pre>
</details>
</dd>
<dt id="slither.service.Service.summarize_weeks"><code class="name flex">
<span>def <span class="ident">summarize_weeks</span></span>(<span>self, sport=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def summarize_weeks(self, sport=None):
    return WeekSummary(self.database).summarize(sport)</code></pre>
</details>
</dd>
<dt id="slither.service.Service.summarize_years"><code class="name flex">
<span>def <span class="ident">summarize_years</span></span>(<span>self, sport=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def summarize_years(self, sport=None):
    return YearSummary(self.database).summarize(sport)</code></pre>
</details>
</dd>
<dt id="slither.service.Service.sync_to_server"><code class="name flex">
<span>def <span class="ident">sync_to_server</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def sync_to_server(self):
    Synchronizer(self, self.remote, self.username, self.password
                 ).sync_to_server()</code></pre>
</details>
</dd>
<dt id="slither.service.Service.update_activity"><code class="name flex">
<span>def <span class="ident">update_activity</span></span>(<span>self, activity, metadata)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_activity(self, activity, metadata):
    self.registry.delete(activity.get_filename())
    self._delete_records_for(activity)
    self.database.session.flush()

    for k, v in metadata.items():
        setattr(activity, k, v)

    self._store_activity(activity)</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="slither" href="index.html">slither</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="slither.service.Service" href="#slither.service.Service">Service</a></code></h4>
<ul class="">
<li><code><a title="slither.service.Service.add_new_activity" href="#slither.service.Service.add_new_activity">add_new_activity</a></code></li>
<li><code><a title="slither.service.Service.clone" href="#slither.service.Service.clone">clone</a></code></li>
<li><code><a title="slither.service.Service.delete_activity" href="#slither.service.Service.delete_activity">delete_activity</a></code></li>
<li><code><a title="slither.service.Service.get_best_splits" href="#slither.service.Service.get_best_splits">get_best_splits</a></code></li>
<li><code><a title="slither.service.Service.import_activity" href="#slither.service.Service.import_activity">import_activity</a></code></li>
<li><code><a title="slither.service.Service.invalidate_record" href="#slither.service.Service.invalidate_record">invalidate_record</a></code></li>
<li><code><a title="slither.service.Service.list_activities" href="#slither.service.Service.list_activities">list_activities</a></code></li>
<li><code><a title="slither.service.Service.list_activity_for_date" href="#slither.service.Service.list_activity_for_date">list_activity_for_date</a></code></li>
<li><code><a title="slither.service.Service.list_records" href="#slither.service.Service.list_records">list_records</a></code></li>
<li><code><a title="slither.service.Service.new_activity" href="#slither.service.Service.new_activity">new_activity</a></code></li>
<li><code><a title="slither.service.Service.summarize_months" href="#slither.service.Service.summarize_months">summarize_months</a></code></li>
<li><code><a title="slither.service.Service.summarize_weeks" href="#slither.service.Service.summarize_weeks">summarize_weeks</a></code></li>
<li><code><a title="slither.service.Service.summarize_years" href="#slither.service.Service.summarize_years">summarize_years</a></code></li>
<li><code><a title="slither.service.Service.sync_to_server" href="#slither.service.Service.sync_to_server">sync_to_server</a></code></li>
<li><code><a title="slither.service.Service.update_activity" href="#slither.service.Service.update_activity">update_activity</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>